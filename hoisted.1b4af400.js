function F(n){["link","go"].includes(n)&&window.scrollTo({top:0})}function v(n){const e=new URL(n||window.location.href).href;return e.endsWith("/")||e.includes(".")?e:`${e}/`}function S(n){(!window.history.state||window.history.state.url!==n)&&window.history.pushState({url:n},"internalLink",n)}function I(n){document.querySelector(n).scrollIntoView({behavior:"smooth",block:"start"})}function C(n){const e=v();return{type:"popstate",next:e}}function T(n){let e;if(n.altKey||n.ctrlKey||n.metaKey||n.shiftKey)return{type:"disqualified"};for(let t=n.target;t.parentNode;t=t.parentNode)if(t.nodeName==="A"){e=t;break}if(e&&e.host!==location.host)return e.target="_blank",{type:"external"};if(e&&"cold"in e?.dataset)return{type:"disqualified"};if(e!=null&&e.hasAttribute("href")){const t=e.getAttribute("href"),i=new URL(t,location.href);if(n.preventDefault(),t!=null&&t.startsWith("#"))return I(t),{type:"scrolled"};const s=v(i.href),o=v();return{type:"link",next:s,prev:o}}else return{type:"noop"}}function N(n){return new DOMParser().parseFromString(n,"text/html")}function b(n){document.body.replaceWith(n.body)}function A(n){const e=r=>Array.from(r.querySelectorAll('head>:not([rel="prefetch"]')),t=e(document),i=e(n),{staleNodes:s,freshNodes:o}=q(t,i);s.forEach(r=>r.remove()),document.head.append(...o)}function q(n,e){const t=[],i=[];let s=0,o=0;for(;s<n.length||o<e.length;){const r=n[s],a=e[o];if(r!=null&&r.isEqualNode(a)){s++,o++;continue}const l=r?i.findIndex(u=>u.isEqualNode(r)):-1;if(l!==-1){i.splice(l,1),s++;continue}const f=a?t.findIndex(u=>u.isEqualNode(a)):-1;if(f!==-1){t.splice(f,1),o++;continue}r&&t.push(r),a&&i.push(a),s++,o++}return{staleNodes:t,freshNodes:i}}function E(){document.head.querySelectorAll("[data-reload]").forEach(k),document.body.querySelectorAll("script").forEach(k)}function k(n){const e=document.createElement("script"),t=Array.from(n.attributes);for(const{name:i,value:s}of t)e[i]=s;e.append(n.textContent),n.replaceWith(e)}const B={log:!1,pageTransitions:!1};class D{constructor(e){this.opts=e,this.enabled=!0,this.prefetched=new Set,this.opts={...B,...e??{}},window!=null&&window.history?(document.addEventListener("click",t=>this.onClick(t)),window.addEventListener("popstate",t=>this.onPop(t)),this.prefetch()):(console.warn("flamethrower router not supported in this browser or environment"),this.enabled=!1)}go(e){const t=window.location.href,i=new URL(e,location.origin).href;return this.reconstructDOM({type:"go",next:i,prev:t})}back(){window.history.back()}forward(){window.history.forward()}get allLinks(){return Array.from(document.links).filter(e=>e.href.includes(document.location.origin)&&!e.href.includes("#")&&e.href!==(document.location.href||document.location.href+"/")&&!this.prefetched.has(e.href))}log(...e){this.opts.log&&console.log(...e)}prefetch(){if(this.opts.prefetch==="visible")this.prefetchVisible();else if(this.opts.prefetch==="hover")this.prefetchOnHover();else return}prefetchOnHover(){this.allLinks.forEach(e=>{const t=e.getAttribute("href");e.addEventListener("pointerenter",()=>this.createLink(t),{once:!0})})}prefetchVisible(){const e={root:null,rootMargin:"0px",threshold:1};"IntersectionObserver"in window&&(this.observer||(this.observer=new IntersectionObserver((t,i)=>{t.forEach(s=>{const o=s.target.getAttribute("href");if(this.prefetched.has(o)){i.unobserve(s.target);return}s.isIntersecting&&(this.createLink(o),i.unobserve(s.target))})},e)),this.allLinks.forEach(t=>this.observer.observe(t)))}createLink(e){const t=document.createElement("link");t.rel="prefetch",t.href=e,t.as="document",t.onload=()=>this.log("\u{1F329}\uFE0F prefetched",e),t.onerror=i=>this.log("\u{1F915} can't prefetch",e,i),document.head.appendChild(t),this.prefetched.add(e)}onClick(e){this.reconstructDOM(T(e))}onPop(e){this.reconstructDOM(C())}async reconstructDOM({type:e,next:t,prev:i}){if(!this.enabled){this.log("router disabled");return}try{if(this.log("\u26A1",e),["popstate","link","go"].includes(e)&&t!==i){this.opts.log&&console.time("\u23F1\uFE0F"),window.dispatchEvent(new CustomEvent("flamethrower:router:fetch")),e!="popstate"&&S(t);const s=await(await fetch(t,{headers:{"X-Flamethrower":"1"}}).then(r=>{const a=r.body.getReader(),l=parseInt(r.headers.get("Content-Length"));let f=0;return new ReadableStream({start(u){function p(){a.read().then(({done:m,value:g})=>{if(m){u.close();return}f+=g.length,window.dispatchEvent(new CustomEvent("flamethrower:router:fetch-progress",{detail:{progress:Number.isNaN(l)?0:f/l*100,received:f,length:l||0}})),u.enqueue(g),p()})}p()}})}).then(r=>new Response(r,{headers:{"Content-Type":"text/html"}}))).text(),o=N(s);A(o),this.opts.pageTransitions&&document.createDocumentTransition?document.createDocumentTransition().start(()=>{b(o),E()}):(b(o),E()),F(e),window.dispatchEvent(new CustomEvent("flamethrower:router:end")),setTimeout(()=>{this.prefetch()},200),this.opts.log&&console.timeEnd("\u23F1\uFE0F")}}catch(s){return window.dispatchEvent(new CustomEvent("flamethrower:router:error",s)),this.opts.log&&console.timeEnd("\u23F1\uFE0F"),console.error("\u{1F4A5} router fetch failed",s),!1}}}const M=n=>{const e=new D(n);if(n.log&&console.log("\u{1F525} flamethrower engaged"),window){const t=window;t.flamethrower=e}return e};window.router=M({pageTransitions:!1,log:!1,prefetch:"visible"});(()=>{const n=document.getElementById("nav"),e=document.getElementById("nav-toggle"),t=(i,s)=>{s.addEventListener("click",o=>{i.dataset.opened?delete i.dataset.opened:i.dataset.opened="true"})};window.addEventListener("click",i=>{const s=document.getElementById("nav"),o=document.getElementById("nav-toggle");s.dataset.opened&&!o.contains(i.target)&&!s.contains(i.target)&&delete s.dataset.opened}),window.addEventListener("flamethrower:router:end",()=>{const i=document.getElementById("nav"),s=document.getElementById("nav-toggle");t(i,s)}),t(n,e)})();(()=>{const n=document.getElementById("stars"),e=[];function t(o,r){return Math.floor(Math.random()*(r-o+1))+o}const i=o=>{document.querySelector("html").dataset.theme;const r=o.getBoundingClientRect(),a=window.innerHeight*window.innerWidth/19e3;for(let l=0;l<a;l+=1)e[l]={size:t(1,3),x:t(16,r.width-16),y:t(64,r.height-16),pointiness:t(1,2)}},s=o=>{const r=o.getContext("2d"),a=document.querySelector("html"),l=getComputedStyle(a),f=o.getBoundingClientRect();o.width=f.width,o.height=f.height;const u=()=>{const c=a.dataset.theme==="dark";r.fillStyle=`rgb(${l.getPropertyValue(c?"--primary-200":"--primary-600")})`},p=({x:c,y:h,color:y,pointiness:L=3,size:d})=>{y&&(r.fillStyle=y);const w=d*L;r.beginPath(),r.moveTo(c,h-w),r.lineTo(c+d/2,h-d/2),r.lineTo(c+w,h+d/4),r.lineTo(c+d/2,h+d/2),r.lineTo(c-d/4,h+w),r.lineTo(c-d/2,h+d/2),r.lineTo(c-w,h-d/4),r.lineTo(c-d/2,h-d/2),r.closePath(),r.fill(),u()},m=()=>{for(const c of e)p(c)};new MutationObserver(c=>{for(const h of c)h.type==="attributes"&&h.attributeName==="data-theme"&&(u(),m())}).observe(a,{childList:!1,attributes:!0,subtree:!1}),e.length===0&&i(o),u(),m()};window.addEventListener("flamethrower:router:end",()=>{const o=document.getElementById("stars");s(o)}),window.addEventListener("resize",()=>{const o=document.getElementById("stars");i(o),s(o)}),s(n)})();
