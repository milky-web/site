function S(e){["link","go"].includes(e)&&window.scrollTo({top:0})}function b(e){const t=new URL(e||window.location.href).href;return t.endsWith("/")||t.includes(".")?t:`${t}/`}function F(e){(!window.history.state||window.history.state.url!==e)&&window.history.pushState({url:e},"internalLink",e)}function N(e){document.querySelector(e).scrollIntoView({behavior:"smooth",block:"start"})}function M(e){return{type:"popstate",next:b()}}function q(e){let t;if(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return{type:"disqualified"};for(let n=e.target;n.parentNode;n=n.parentNode)if("A"===n.nodeName){t=n;break}if(t&&t.host!==location.host)return t.target="_blank",{type:"external"};if(t&&"cold"in t?.dataset)return{type:"disqualified"};if(null!=t&&t.hasAttribute("href")){const n=t.getAttribute("href"),o=new URL(n,location.href);if(e.preventDefault(),null!=n&&n.startsWith("#"))return N(n),{type:"scrolled"};return{type:"link",next:b(o.href),prev:b()}}return{type:"noop"}}function B(e){return(new DOMParser).parseFromString(e,"text/html")}function E(e){document.body.replaceWith(e.body)}function O(e){const t=e=>Array.from(e.querySelectorAll('head>:not([rel="prefetch"]')),n=t(document),o=t(e),{staleNodes:r,freshNodes:i}=D(n,o);r.forEach((e=>e.remove())),document.head.append(...i)}function D(e,t){const n=[],o=[];let r=0,i=0;for(;r<e.length||i<t.length;){const s=e[r],a=t[i];if(null!=s&&s.isEqualNode(a)){r++,i++;continue}const c=s?o.findIndex((e=>e.isEqualNode(s))):-1;if(-1!==c){o.splice(c,1),r++;continue}const l=a?n.findIndex((e=>e.isEqualNode(a))):-1;-1===l?(s&&n.push(s),a&&o.push(a),r++,i++):(n.splice(l,1),i++)}return{staleNodes:n,freshNodes:o}}function y(){document.head.querySelectorAll("[data-reload]").forEach(k),document.body.querySelectorAll("script").forEach(k)}function k(e){const t=document.createElement("script"),n=Array.from(e.attributes);for(const{name:e,value:o}of n)t[e]=o;t.append(e.textContent),e.replaceWith(t)}const P={log:!1,pageTransitions:!1};class R{constructor(e){this.opts=e,this.enabled=!0,this.prefetched=new Set,this.opts={...P,...e??{}},null!=window&&window.history?(document.addEventListener("click",(e=>this.onClick(e))),window.addEventListener("popstate",(e=>this.onPop(e))),this.prefetch()):(console.warn("flamethrower router not supported in this browser or environment"),this.enabled=!1)}go(e){const t=window.location.href,n=new URL(e,location.origin).href;return this.reconstructDOM({type:"go",next:n,prev:t})}back(){window.history.back()}forward(){window.history.forward()}get allLinks(){return Array.from(document.links).filter((e=>e.href.includes(document.location.origin)&&!e.href.includes("#")&&e.href!==(document.location.href||document.location.href+"/")&&!this.prefetched.has(e.href)))}log(...e){this.opts.log&&console.log(...e)}prefetch(){if("visible"===this.opts.prefetch)this.prefetchVisible();else{if("hover"!==this.opts.prefetch)return;this.prefetchOnHover()}}prefetchOnHover(){this.allLinks.forEach((e=>{const t=e.getAttribute("href");e.addEventListener("pointerenter",(()=>this.createLink(t)),{once:!0})}))}prefetchVisible(){"IntersectionObserver"in window&&(this.observer||(this.observer=new IntersectionObserver(((e,t)=>{e.forEach((e=>{const n=e.target.getAttribute("href");this.prefetched.has(n)?t.unobserve(e.target):e.isIntersecting&&(this.createLink(n),t.unobserve(e.target))}))}),{root:null,rootMargin:"0px",threshold:1})),this.allLinks.forEach((e=>this.observer.observe(e))))}createLink(e){const t=document.createElement("link");t.rel="prefetch",t.href=e,t.as="document",t.onload=()=>this.log("🌩️ prefetched",e),t.onerror=t=>this.log("🤕 can't prefetch",e,t),document.head.appendChild(t),this.prefetched.add(e)}onClick(e){this.reconstructDOM(q(e))}onPop(e){this.reconstructDOM(M())}async reconstructDOM({type:e,next:t,prev:n}){if(this.enabled)try{if(this.log("⚡",e),["popstate","link","go"].includes(e)&&t!==n){this.opts.log&&console.time("⏱️"),window.dispatchEvent(new CustomEvent("flamethrower:router:fetch")),"popstate"!=e&&F(t);const n=B(await(await fetch(t,{headers:{"X-Flamethrower":"1"}}).then((e=>{const t=e.body.getReader(),n=parseInt(e.headers.get("Content-Length"));let o=0;return new ReadableStream({start(e){!function r(){t.read().then((({done:t,value:i})=>{t?e.close():(o+=i.length,window.dispatchEvent(new CustomEvent("flamethrower:router:fetch-progress",{detail:{progress:Number.isNaN(n)?0:o/n*100,received:o,length:n||0}})),e.enqueue(i),r())}))}()}})})).then((e=>new Response(e,{headers:{"Content-Type":"text/html"}})))).text());O(n),this.opts.pageTransitions&&document.createDocumentTransition?document.createDocumentTransition().start((()=>{E(n),y()})):(E(n),y()),S(e),window.dispatchEvent(new CustomEvent("flamethrower:router:end")),setTimeout((()=>{this.prefetch()}),200),this.opts.log&&console.timeEnd("⏱️")}}catch(e){return window.dispatchEvent(new CustomEvent("flamethrower:router:error",e)),this.opts.log&&console.timeEnd("⏱️"),console.error("💥 router fetch failed",e),!1}else this.log("router disabled")}}const x=e=>{const t=new R(e);if(e.log&&console.log("🔥 flamethrower engaged"),window){window.flamethrower=t}return t};window.router=x({pageTransitions:!1,log:!1,prefetch:"visible"});const H=new MutationObserver((e=>{const t=e[0];"attributes"===t.type&&"data-theme"===t.attributeName&&window.dispatchEvent(new CustomEvent("themeChange",{detail:{newTheme:t.target.dataset.theme}}))}));H.observe(document.querySelector("html"),{childList:!1,attributes:!0,subtree:!1}),(()=>{const e=document.querySelector("html"),t=document.getElementById("nav"),n=document.getElementById("nav-toggle"),o=(t,n)=>{n.addEventListener("click",(e=>{t.dataset.opened?delete t.dataset.opened:t.dataset.opened="true"})),new MutationObserver((t=>{for(const o of t)"attributes"===o.type&&"data-theme"===o.attributeName&&n.children[0].setAttribute("fill","dark"===e.dataset.theme?"white":"black")})).observe(e,{childList:!1,attributes:!0,subtree:!1}),n.children[0].setAttribute("fill","dark"===e.dataset.theme?"white":"black")};window.addEventListener("click",(e=>{const t=document.getElementById("nav"),n=document.getElementById("nav-toggle");t.dataset.opened&&!n.contains(e.target)&&!t.contains(e.target)&&delete t.dataset.opened})),window.addEventListener("flamethrower:router:end",(()=>{const e=document.getElementById("nav"),t=document.getElementById("nav-toggle");o(e,t)})),o(t,n)})(),(()=>{const e=document.getElementById("stars");let t=[];function n(e,t){return Math.floor(Math.random()*(t-e+1))+e}const o=(e,o)=>{const r=e.getContext("2d"),i=document.querySelector("html"),s=document.querySelector("main"),a=getComputedStyle(i),c=e.getBoundingClientRect(),l=s.getBoundingClientRect();e.width=c.width,e.style.height=l.height+"px",e.height=l.height;const d=()=>{const e="dark"===i.dataset.theme;r.fillStyle=`rgb(${a.getPropertyValue(e?"--primary-200":"--primary-600")})`},h=({x:e,y:t,color:n,rotation:o,pointiness:i=3,size:s})=>{n&&(r.fillStyle=n);const a=s*i;r.translate(e,t),r.rotate(o*Math.PI/180),r.translate(-e,-t),r.beginPath(),r.moveTo(e,t-a),r.lineTo(e+s/2,t-s/2),r.lineTo(e+a,t+s/4),r.lineTo(e+s/2,t+s/2),r.lineTo(e-s/4,t+a),r.lineTo(e-s/2,t+s/2),r.lineTo(e-a,t-s/4),r.lineTo(e-s/2,t-s/2),r.closePath(),r.setTransform(),r.fill(),n&&d()};(o||0===t.length)&&(()=>{t=[];const o=e.getBoundingClientRect(),r=1e4*window.innerWidth/25e3;for(let e=0;e<r;e+=1)t[e]={size:n(1,3),x:n(16,o.width-16),y:n(64,9984),rotation:n(0,90),pointiness:n(1,2)}})(),d(),(()=>{for(const e of t)e.y>l.height||h(e)})()};window.addEventListener("flamethrower:router:end",(()=>{const e=document.getElementById("stars");o(e)})),window.addEventListener("resize",(()=>{const e=document.getElementById("stars");o(e,!0)})),window.addEventListener("themeChange",(()=>{const e=document.getElementById("stars");o(e)})),o(e)})();