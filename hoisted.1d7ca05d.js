function F(o){["link","go"].includes(o)&&window.scrollTo({top:0})}function b(o){const e=new URL(o||window.location.href).href;return e.endsWith("/")||e.includes(".")?e:`${e}/`}function I(o){(!window.history.state||window.history.state.url!==o)&&window.history.pushState({url:o},"internalLink",o)}function T(o){document.querySelector(o).scrollIntoView({behavior:"smooth",block:"start"})}function A(o){const e=b();return{type:"popstate",next:e}}function N(o){let e;if(o.altKey||o.ctrlKey||o.metaKey||o.shiftKey)return{type:"disqualified"};for(let t=o.target;t.parentNode;t=t.parentNode)if(t.nodeName==="A"){e=t;break}if(e&&e.host!==location.host)return e.target="_blank",{type:"external"};if(e&&"cold"in e?.dataset)return{type:"disqualified"};if(e!=null&&e.hasAttribute("href")){const t=e.getAttribute("href"),i=new URL(t,location.href);if(o.preventDefault(),t!=null&&t.startsWith("#"))return T(t),{type:"scrolled"};const n=b(i.href),s=b();return{type:"link",next:n,prev:s}}else return{type:"noop"}}function q(o){return new DOMParser().parseFromString(o,"text/html")}function E(o){document.body.replaceWith(o.body)}function B(o){const e=r=>Array.from(r.querySelectorAll('head>:not([rel="prefetch"]')),t=e(document),i=e(o),{staleNodes:n,freshNodes:s}=M(t,i);n.forEach(r=>r.remove()),document.head.append(...s)}function M(o,e){const t=[],i=[];let n=0,s=0;for(;n<o.length||s<e.length;){const r=o[n],c=e[s];if(r!=null&&r.isEqualNode(c)){n++,s++;continue}const h=r?i.findIndex(f=>f.isEqualNode(r)):-1;if(h!==-1){i.splice(h,1),n++;continue}const u=c?t.findIndex(f=>f.isEqualNode(c)):-1;if(u!==-1){t.splice(u,1),s++;continue}r&&t.push(r),c&&i.push(c),n++,s++}return{staleNodes:t,freshNodes:i}}function k(){document.head.querySelectorAll("[data-reload]").forEach(L),document.body.querySelectorAll("script").forEach(L)}function L(o){const e=document.createElement("script"),t=Array.from(o.attributes);for(const{name:i,value:n}of t)e[i]=n;e.append(o.textContent),o.replaceWith(e)}const O={log:!1,pageTransitions:!1};class D{constructor(e){this.opts=e,this.enabled=!0,this.prefetched=new Set,this.opts={...O,...e??{}},window!=null&&window.history?(document.addEventListener("click",t=>this.onClick(t)),window.addEventListener("popstate",t=>this.onPop(t)),this.prefetch()):(console.warn("flamethrower router not supported in this browser or environment"),this.enabled=!1)}go(e){const t=window.location.href,i=new URL(e,location.origin).href;return this.reconstructDOM({type:"go",next:i,prev:t})}back(){window.history.back()}forward(){window.history.forward()}get allLinks(){return Array.from(document.links).filter(e=>e.href.includes(document.location.origin)&&!e.href.includes("#")&&e.href!==(document.location.href||document.location.href+"/")&&!this.prefetched.has(e.href))}log(...e){this.opts.log&&console.log(...e)}prefetch(){if(this.opts.prefetch==="visible")this.prefetchVisible();else if(this.opts.prefetch==="hover")this.prefetchOnHover();else return}prefetchOnHover(){this.allLinks.forEach(e=>{const t=e.getAttribute("href");e.addEventListener("pointerenter",()=>this.createLink(t),{once:!0})})}prefetchVisible(){const e={root:null,rootMargin:"0px",threshold:1};"IntersectionObserver"in window&&(this.observer||(this.observer=new IntersectionObserver((t,i)=>{t.forEach(n=>{const s=n.target.getAttribute("href");if(this.prefetched.has(s)){i.unobserve(n.target);return}n.isIntersecting&&(this.createLink(s),i.unobserve(n.target))})},e)),this.allLinks.forEach(t=>this.observer.observe(t)))}createLink(e){const t=document.createElement("link");t.rel="prefetch",t.href=e,t.as="document",t.onload=()=>this.log("\u{1F329}\uFE0F prefetched",e),t.onerror=i=>this.log("\u{1F915} can't prefetch",e,i),document.head.appendChild(t),this.prefetched.add(e)}onClick(e){this.reconstructDOM(N(e))}onPop(e){this.reconstructDOM(A())}async reconstructDOM({type:e,next:t,prev:i}){if(!this.enabled){this.log("router disabled");return}try{if(this.log("\u26A1",e),["popstate","link","go"].includes(e)&&t!==i){this.opts.log&&console.time("\u23F1\uFE0F"),window.dispatchEvent(new CustomEvent("flamethrower:router:fetch")),e!="popstate"&&I(t);const n=await(await fetch(t,{headers:{"X-Flamethrower":"1"}}).then(r=>{const c=r.body.getReader(),h=parseInt(r.headers.get("Content-Length"));let u=0;return new ReadableStream({start(f){function p(){c.read().then(({done:w,value:g})=>{if(w){f.close();return}u+=g.length,window.dispatchEvent(new CustomEvent("flamethrower:router:fetch-progress",{detail:{progress:Number.isNaN(h)?0:u/h*100,received:u,length:h||0}})),f.enqueue(g),p()})}p()}})}).then(r=>new Response(r,{headers:{"Content-Type":"text/html"}}))).text(),s=q(n);B(s),this.opts.pageTransitions&&document.createDocumentTransition?document.createDocumentTransition().start(()=>{E(s),k()}):(E(s),k()),F(e),window.dispatchEvent(new CustomEvent("flamethrower:router:end")),setTimeout(()=>{this.prefetch()},200),this.opts.log&&console.timeEnd("\u23F1\uFE0F")}}catch(n){return window.dispatchEvent(new CustomEvent("flamethrower:router:error",n)),this.opts.log&&console.timeEnd("\u23F1\uFE0F"),console.error("\u{1F4A5} router fetch failed",n),!1}}}const R=o=>{const e=new D(o);if(o.log&&console.log("\u{1F525} flamethrower engaged"),window){const t=window;t.flamethrower=e}return e};window.router=R({pageTransitions:!1,log:!1,prefetch:"visible"});const x=new MutationObserver(o=>{for(const e of o)e.type==="attributes"&&e.attributeName==="data-theme"&&window.dispatchEvent(new CustomEvent("themeChange",{detail:{newTheme:e.target.dataset.theme}}))});x.observe(document.querySelector("html"),{childList:!1,attributes:!0,subtree:!1});(()=>{const o=document.querySelector("html"),e=document.getElementById("nav"),t=document.getElementById("nav-toggle"),i=(n,s)=>{s.addEventListener("click",c=>{n.dataset.opened?delete n.dataset.opened:n.dataset.opened="true"}),new MutationObserver(c=>{for(const h of c)h.type==="attributes"&&h.attributeName==="data-theme"&&s.children[0].setAttribute("fill",o.dataset.theme==="dark"?"white":"black")}).observe(o,{childList:!1,attributes:!0,subtree:!1}),s.children[0].setAttribute("fill",o.dataset.theme==="dark"?"white":"black")};window.addEventListener("click",n=>{const s=document.getElementById("nav"),r=document.getElementById("nav-toggle");s.dataset.opened&&!r.contains(n.target)&&!s.contains(n.target)&&delete s.dataset.opened}),window.addEventListener("flamethrower:router:end",()=>{const n=document.getElementById("nav"),s=document.getElementById("nav-toggle");i(n,s)}),i(e,t)})();(()=>{const o=document.getElementById("stars");let e=[];function t(n,s){return Math.floor(Math.random()*(s-n+1))+n}const i=(n,s)=>{const r=n.getContext("2d"),c=document.querySelector("html"),h=document.querySelector("main"),u=getComputedStyle(c),f=n.getBoundingClientRect(),p=h.getBoundingClientRect();n.width=f.width,n.style.height=p.height+"px",n.height=p.height;const w=()=>{const a=c.dataset.theme==="dark";r.fillStyle=`rgb(${u.getPropertyValue(a?"--primary-200":"--primary-600")})`},g=({x:a,y:l,color:m,rotation:y,pointiness:C=3,size:d})=>{m&&(r.fillStyle=m);const v=d*C;r.translate(a,l),r.rotate(y*Math.PI/180),r.translate(-a,-l),r.beginPath(),r.moveTo(a,l-v),r.lineTo(a+d/2,l-d/2),r.lineTo(a+v,l+d/4),r.lineTo(a+d/2,l+d/2),r.lineTo(a-d/4,l+v),r.lineTo(a-d/2,l+d/2),r.lineTo(a-v,l-d/4),r.lineTo(a-d/2,l-d/2),r.closePath(),r.setTransform(),r.fill(),m&&w()},S=()=>{for(const a of e)a.y>p.height||g(a)};s||(()=>{const a=n.getBoundingClientRect(),l=p.height*window.innerWidth/25e3;for(let m=0;m<l;m+=1)e[m]||(e[m]={size:t(1,3),x:t(16,a.width-16),y:t(64,a.height-16),rotation:t(0,90),pointiness:t(1,2)})})(),w(),S()};window.addEventListener("flamethrower:router:end",()=>{const n=document.getElementById("stars");i(n)}),window.addEventListener("resize",()=>{const n=document.getElementById("stars");i(n)}),window.addEventListener("themeChange",()=>{const n=document.getElementById("stars");i(n,!0)}),i(o)})();
